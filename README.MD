# Talon Async IO: åŸºäº io_uring çš„é«˜æ€§èƒ½å¼‚æ­¥ I/O æ¡†æ¶

[![Header-only](https://img.shields.io/badge/Header--only-Efficient-brightgreen)]()
[![Linux](https://img.shields.io/badge/Platform-Linux%20Kernelâ‰¥5.11-blue)](https://www.kernel.org/)

**Talon Async IO** æ˜¯ä¸€ä¸ªåŸºäº Linux io_uring å­ç³»ç»Ÿæ„å»ºçš„ç°ä»£å¼‚æ­¥ I/O å¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨Handleré©±åŠ¨åˆ›å»ºä»»åŠ¡çš„ç¼–ç¨‹æ¨¡å‹å’Œå•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¶æ„ï¼Œä¸ºå¼€å‘è€…æä¾›é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„ I/O æ“ä½œè§£å†³æ–¹æ¡ˆã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ğŸš€ é›¶ä¾èµ–é«˜æ€§èƒ½
- çº¯å¤´æ–‡ä»¶å®ç°ï¼Œæ— é¢å¤–ç¼–è¯‘ä¾èµ–
- Handleré©±åŠ¨ç¼–ç¨‹æ¨¡å‹ï¼ŒåŒä¸€å¼IOç¼–ç¨‹æ¨¡å‹ï¼Œå‡å°‘ä¼ ç»Ÿå¼‚æ­¥å‡½æ•°å›è°ƒåœ°ç‹±
- å°è£… io_uring ç”¨æˆ·æ€-å†…æ ¸æ€é›¶æ‹·è´ç³»ç»Ÿè°ƒç”¨
- å•çº¿ç¨‹äº‹ä»¶å¾ªç¯è®¾è®¡ï¼Œæè‡´å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€

### ğŸ§© ç»Ÿä¸€æŠ½è±¡å±‚
- æ–‡ä»¶ I/O ä¸ç½‘ç»œ I/O ç»Ÿä¸€æ“ä½œè¯­ä¹‰
- æ”¯æŒå¤šç§ I/O æ¨¡å¼ï¼š
  | æ¨¡å¼ç±»å‹        | æè¿°                      |
  |----------------|--------------------------|
  | çŸ­è¿æ¥ä»»åŠ¡      | é»˜è®¤çš„å•æ¬¡æ‰§è¡Œæ¨¡å¼        |
  | é•¿è¿æ¥ä»»åŠ¡      | æ”¯æŒæ°¸ä¹…å¾ªç¯æ‰§è¡Œ          |
  | é“¾å¼ä»»åŠ¡        | é€šè¿‡ next æŒ‡é’ˆæ„å»ºä»»åŠ¡æ‹“æ‰‘ |

### âš¡ ç°ä»£åŒ–å¼€å‘èŒƒå¼

```cpp
talon::IOHandler io;
// ç¤ºä¾‹ï¼šå¼‚æ­¥è¯»å¤„ç†å™¨
Ret custom_read_handler(KernelBufPtr kbf, out_res* ptr) {
    auto num = kbf->io_ret_v();
    auto fd = kbf->io_ret_fd();
    printf("in example_read_handler ret = %d, fd = %d\n", num, fd);
    for (int i = 0; i < num; i++) {
        printf("%c", kbf->buf_[i]);
    }
    ptr = some excute result;
    return 
}

// ä»»åŠ¡åˆ›å»ºä¸æäº¤
auto task = createTaskWithHandler(
    fd, 
    custom_read_handler, 
    ptr_arg
);
task->set_timeout(100ms);
readtask->set_task_type(task::TaskType::READ);
accpet_task->set_repeat_forever(true);
io.addTask(task);
```

### âš¡å…¶ä»–
å…¶æ›´å¤šä½¿ç”¨æ–¹å¼ï¼Œå¦‚å®¢æˆ·ç«¯æœåŠ¡ç«¯çš„ç½‘ç»œIOé€šè®¯ã€æœ¬åœ°æ–‡ä»¶è¯»å–ã€å¤§æ–‡ä»¶çš„è¯»å–ç­‰ç›¸å…³æ“ä½œè§ç›¸å…³example.ccæ–‡ä»¶ã€‚
### åç»­ä¼šæä¾›ç›¸å…³æ€§èƒ½æµ‹è¯•

continue...